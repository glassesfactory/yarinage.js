var Yarinage;Yarinage=function(){function e(e){var t;this.success=e&&e.success?e.success:null,this.error=e&&e.error?e.error:null,t=navigator.userAgent,this.isChrome=t.match(/Chrome\/\d+/g)?!0:!1,console.log(this.isChrome)}return e.prototype.xhr=null,e.prototype.success=null,e.prototype.error=null,e.prototype.load=function(e,t){var n,r,i,s=this;return i=t&&t.method?t.method:"GET",r=t&&t.contentType?t.contentType:"application/x-msgpack",n=t&&t.async?t.async:!0,this.success=t&&t.success?t.success:this.success,this.error=t&&t.error?t.error:this.error,this.xhr=this._setupXHR(i,e,n,!0),this.xhr.onreadystatechange=function(){var e;if(s.xhr.readyState===4){if(s.xhr.status===200||s.xhr.status===304){if(s.success)return e=msgpack.unpack(new Uint8Array(s.xhr.response)),s.success.apply(s,[e])}else if(s.error)return s.error.apply(s,s.xhr)}else if(s.xhr.status!==200&&s.xhr.status!==304)return s.error.apply(s,s.xhr)},this.xhr.send()},e.prototype.upload=function(e,t,n){var r,i,s,o,u;return o=n&&n.method?n.method:"POST",s=n&&n.contentType?n.contentType:"application/x-msgpack; charset=x-user-defined",r=n&&n.async?n.async:!0,this.success=n&&n.success?n.success:this.success,this.error=n&&n.error?n.error:this.error,u=msgpack.pack(t),i=new Uint8Array(u),this.xhr=this._setupXHR(o,e,r),n&&n.responseType&&(this.xhr.responseType=n.responseType),this.xhr.setRequestHeader("Content-Type",s),this.isChrome?this.xhr.send(i):this.xhr.send(i.buffer),this.xhr},e.prototype._setupXHR=function(e,t,n,r){var i,s=this;i=this._createXHR();if(i===null)throw new Error("your browser だめぽ");return i.open(e,t,n),r===!0&&(i.responseType="arraybuffer"),i.onreadystatechange=function(){if(i.readyState===4){if(i.status===200||i.status===304){if(s.success)return s.success.apply(s,[i.response])}else if(s.error)return s.error.apply(s,[i])}else if(s.xhr.status!==200&&s.xhr.status!==304)return s.error.apply(s,[i])},i},e.prototype._createXHR=function(){if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:null;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}},e.prototype.destory=function(){return this.xhr=null,this.success=null,this.error=null},e}();